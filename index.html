<meta name="viewport" content="width=device-width, initial-scale=1">
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>腰部セルフチェック｜野球選手版 LITE（保存なし） v1.3（現場優先・簡素表示）</title>
<style>
  :root{
    --bg:#0f0f12;--card:#17181c;--ink:#e9eef5;--muted:#aab3c2;--accent:#3aaed8;--danger:#ff4d4f;--warn:#f5a524;--good:#36c26e;--info:#4da3ff;
    --border:#2a2d36;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",Meiryo,sans-serif}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(23,24,28,.98),rgba(23,24,28,.92));backdrop-filter:saturate(120%) blur(8px);z-index:10;border-bottom:1px solid var(--border)}
  header .row{display:flex;gap:.75rem;align-items:center;justify-content:space-between;padding:.75rem clamp(.8rem,3vw,1.2rem)}
  h1{font-size:clamp(1.05rem,2.5vw,1.3rem);margin:0;font-weight:700;letter-spacing:.02em}
  .pill{font-size:.8rem;color:var(--muted);}
  main{max-width:980px;margin:0 auto;padding:1rem clamp(.8rem,3vw,1.2rem) 3rem}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1rem;margin:.9rem 0}
  .section-title{display:flex;align-items:center;gap:.5rem;font-weight:800;margin:.2rem 0 .6rem}
  .hint{color:var(--muted);font-size:.9rem}
  .checks{display:grid;grid-template-columns:1fr;gap:.5rem}
  @media(min-width:680px){.checks{grid-template-columns:1fr 1fr}}
  .check{background:#111217;border:1px solid var(--border);border-radius:12px;padding:.7rem .85rem;display:flex;gap:.6rem;align-items:flex-start}
  .check input{transform:scale(1.2);margin-top:.25rem}
  .toolbar{display:flex;flex-wrap:wrap;gap:.6rem}
  button{
    appearance:none;border:none;border-radius:12px;padding:.7rem .95rem;background:#1e232b;color:var(--ink);
    font-weight:700;border:1px solid var(--border);cursor:pointer
  }
  button.primary{background:var(--accent);color:#071018;border-color:transparent}
  button.ghost{background:transparent}
  .status{border-radius:12px;padding:.9rem 1rem;border:1px solid var(--border);display:flex;gap:.8rem;align-items:flex-start}
  .badge{font-weight:800;padding:.25rem .55rem;border-radius:999px}
  .danger-badge{background:var(--danger);color:#111}
  .warn-badge{background:var(--warn);color:#111}
  .ok-badge{background:var(--good);color:#031}
  .info-badge{background:var(--info);color:#021}
  details{border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#111217}
  summary{cursor:pointer;padding:.9rem 1rem;background:#12131a;font-weight:700;list-style:none}
  summary::-webkit-details-marker{display:none}
  details .content{padding:.8rem .9rem 1rem}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.9rem}
  @media print{header,.no-print{display:none!important} body{background:#fff;color:#000} .card{border-color:#ccc}}
  .pill2{display:inline-block;font-size:.8rem;padding:.15rem .5rem;border:1px solid var(--border);border-radius:999px;background:#101218;color:#aab3c2}
  .none-row{grid-column:1/-1;opacity:.9}
  .howto{display:grid;gap:.4rem;margin:.4rem 0 .2rem}
  .howto div{display:flex;gap:.6rem;align-items:flex-start}
  .howto b{display:inline-block;width:1.4rem;text-align:center;background:#243243;color:#9fd6ff;border-radius:6px}
</style>
</head>
<body>
<header>
  <div class="row">
    <h1>腰部セルフチェック｜野球選手版 LITE（保存なし） <span style="opacity:.6">v1.3 現場優先</span></h1>
    <div class="pill">オフライン可・保存なし・結果のみ共有</div>
  </div>
</header>

<main>
  <section class="card">
    <div class="section-title">使い方 <span class="pill2">チェック → 自動判定 → コピー/印刷</span></div>
    <div class="howto">
      <div><b>1</b><span>当てはまる項目にチェック。<u>「特になし」は他の項目と排他</u>です。</span></div>
      <div><b>2</b><span>下の<span class="pill2">受診必要性 & 参加目安</span>が自動更新されます。</span></div>
      <div><b>3</b><span>「結果をコピー」または「PDFに書き出す」で必要に応じて共有。</span></div>
    </div>
  </section>

  <section class="card">
    <div class="section-title">受診必要性 & 競技参加の自動判定 <span class="pill2">参考</span></div>
    <div id="statusBox" class="status">
      <span id="statusBadge" class="badge ok-badge">様子観察（所見なし）</span>
      <div>
        <div id="statusText">チェックを入れると自動判定します。</div>
        <div id="playText" class="hint">参加目安：全面参加可（痛みゼロ／可動域正常が前提）</div>
        <div id="summary" class="mono" style="margin-top:.4rem;white-space:pre-wrap"></div>
      </div>
    </div>
  </section>

  <details open class="card">
    <summary>① 筋筋膜性腰痛（急性・亜急性）</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="mfp" data-weight="1" id="mfp_local"> <span>局所の圧痛・張り感</span></label>
      <label class="check"><input type="checkbox" data-group="mfp" data-weight="1" id="mfp_bend"> <span>前屈や起き上がりで痛む</span></label>
      <label class="check"><input type="checkbox" data-group="mfp" data-weight="1" id="mfp_roll"> <span>寝返りで痛む／こわばり</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="mfp" id="mfp_none"> <span>特になし</span></label>
    </div>
  </details>

  <details class="card">
    <summary>② 腰椎分離症・すべり症 疑い</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="spondy" data-weight="3" id="spondy_extend"> <span>腰の伸展（反り）で痛む</span></label>
      <label class="check"><input type="checkbox" data-group="spondy" data-weight="3" id="spondy_oneleg"> <span>片脚後屈（折りたたみ伸展）で痛む</span></label>
      <label class="check"><input type="checkbox" data-group="spondy" data-weight="2" id="spondy_afternoon"> <span>午後〜練習後に痛みが増す</span></label>
      <label class="check"><input type="checkbox" data-group="spondy" data-weight="2" id="spondy_history"> <span>分離の既往／画像で指摘歴あり</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="spondy" id="spondy_none"> <span>特になし</span></label>
    </div>
  </details>

  <details class="card">
    <summary>③ 椎間板ヘルニア 疑い</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="hernia" data-weight="3" id="hernia_leg"> <span>臀部〜下肢への放散痛／しびれ</span></label>
      <label class="check"><input type="checkbox" data-group="hernia" data-weight="2" id="hernia_cough"> <span>咳・くしゃみ・いきみで悪化</span></label>
      <label class="check"><input type="checkbox" data-group="hernia" data-weight="3" id="hernia_slr"> <span>SLR（下肢伸展挙上）で症状再現</span></label>
      <label class="check"><input type="checkbox" data-group="hernia" data-weight="3" id="hernia_weak"> <span>足趾背屈/足関節底屈の筋力低下感</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="hernia" id="hernia_none"> <span>特になし</span></label>
    </div>
  </details>

  <details class="card">
    <summary>④ 急性腰痛（ぎっくり腰）</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="acute" data-weight="2" id="acute_onset"> <span>動作をきっかけに急激に発症</span></label>
      <label class="check"><input type="checkbox" data-group="acute" data-weight="2" id="acute_guard"> <span>姿勢保持が困難／防御的</span></label>
      <label class="check"><input type="checkbox" data-group="acute" data-weight="1" id="acute_local"> <span>局所の強い圧痛</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="acute" id="acute_none"> <span>特になし</span></label>
    </div>
  </details>

  <details class="card">
    <summary>⑤ 慢性腰痛</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="chronic" data-weight="1" id="chronic_3m"> <span>3か月以上痛みが続く</span></label>
      <label class="check"><input type="checkbox" data-group="chronic" data-weight="1" id="chronic_flare"> <span>反復的にぶり返す</span></label>
      <label class="check"><input type="checkbox" data-group="chronic" data-weight="1" id="chronic_stiff"> <span>朝のこわばり・運動不足・睡眠不良</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="chronic" id="chronic_none"> <span>特になし</span></label>
    </div>
  </details>

  <details class="card">
    <summary>⑥ 野球特異的サイン</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="baseball" data-weight="2" id="bb_extrot_hit"> <span>打撃の伸展＋回旋で痛む（インパクト付近）</span></label>
      <label class="check"><input type="checkbox" data-group="baseball" data-weight="2" id="bb_throw_end"> <span>投球終末相で腰部痛（フォロースルー）</span></label>
      <label class="check"><input type="checkbox" data-group="baseball" data-weight="2" id="bb_sprint"> <span>盗塁スタートなど加速局面で痛む</span></label>
      <label class="check"><input type="checkbox" data-group="baseball" data-weight="2" id="bb_loadspike"> <span>前週比で走・投・打いずれか30％以上増加（負荷スパイク）</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="baseball" id="baseball_none"> <span>特になし</span></label>
    </div>
  </details>

  <details class="card">
    <summary>⑦ レッドフラッグ（緊急度高）</summary>
    <div class="content checks">
      <label class="check"><input type="checkbox" data-group="red" data-weight="6" id="red_bladder"> <span>排尿困難・尿失禁／便失禁（膀胱直腸障害）</span></label>
      <label class="check"><input type="checkbox" data-group="red" data-weight="6" id="red_saddle"> <span>鞍部（股間まわり）の感覚低下</span></label>
      <label class="check"><input type="checkbox" data-group="red" data-weight="5" id="red_bilatleg"> <span>両下肢のしびれ・筋力低下</span></label>
      <label class="check"><input type="checkbox" data-group="red" data-weight="4" id="red_fever"> <span>発熱・悪寒・原因不明の体調不良</span></label>
      <label class="check"><input type="checkbox" data-group="red" data-weight="4" id="red_weightloss"> <span>原因不明の体重減少</span></label>
      <label class="check"><input type="checkbox" data-group="red" data-weight="4" id="red_cancer"> <span>がんの既往・免疫抑制・長期ステロイド</span></label>
      <label class="check"><input type="checkbox" data-group="red" data-weight="4" id="red_trauma"> <span>強い外傷（転落・交通事故 等）</span></label>
      <label class="check none-row"><input type="checkbox" class="none-option" data-group="red" id="red_none"> <span>特になし</span></label>
    </div>
  </details>

  <section class="card no-print">
    <div class="toolbar">
      <button class="primary" id="btnCopy">結果をコピー</button>
      <button id="btnPrint">PDFに書き出す（印刷）</button>
      <button class="ghost" id="btnReset">判定をリセット</button>
    </div>
  </section>
</main>

<script>
(function(){
  var $=function(s){return document.querySelector(s)};
  var $$=function(s){return Array.prototype.slice.call(document.querySelectorAll(s))};

  function hook(){
    $$('.none-option').forEach(function(n){
      n.addEventListener('change', function(e){
        var g=e.target.getAttribute('data-group');
        if(e.target.checked){
          $$('input[type="checkbox"][data-group="'+g+'"]:not(.none-option)').forEach(function(cb){ cb.checked=false; });
        }
        evaluate();
      });
    });
    $$('input[type="checkbox"]:not(.none-option)').forEach(function(cb){
      cb.addEventListener('change', function(e){
        var g=e.target.getAttribute('data-group');
        if(g){
          var none=document.querySelector('.none-option[data-group="'+g+'"]');
          if(none && e.target.checked){ none.checked=false; }
        }
        evaluate();
      });
    });
  }

  function evaluate(){
    var cbs = $$('input[type="checkbox"]:not(.none-option)');
    var checked = cbs.filter(function(x){ return x.checked; });
    var score = checked.reduce(function(s,c){ return s + (Number(c.getAttribute('data-weight'))||1); }, 0);
    function has(id){ var el=$('#'+id); return el && el.checked; }

    var hasCritical = ['red_bladder','red_saddle','red_bilatleg'].some(has);
    var redHigh = ['red_fever','red_weightloss','red_cancer','red_trauma'].some(has);
    var spike = has('bb_loadspike');

    var herniaCombo = (has('hernia_leg') && (has('hernia_slr') || has('hernia_weak')));
    var spondyCombo = (has('spondy_extend') && has('spondy_oneleg'));

    var level = 0;
    if(hasCritical){
      level = 3;
    }else{
      if(score===0){ level=0; }
      else if(score<=2){ level=1; }
      else if(score<=5){ level=2; }
      else{ level=3; }
      if(herniaCombo || spondyCombo) level = Math.max(level,2);
      if(redHigh) level = Math.max(level,2);
      if(spike && level<2) level = 2;
    }

    var playAdvice = [
      '全面参加可（痛みゼロ／可動域正常／走・投・打で違和感なしが前提）',
      '制限付き参加（走は距離短・傾斜回避、投は距離短/回数半分、打はティー中心）。24–72時間で再評価。',
      '練習中止。軽負荷リハのみ（股関節モビ・体幹スタビ・ハム/臀リワーク）。医療受診を検討。',
      '競技中止。できるだけ早く医療機関を受診。固定・冷却・疼痛管理を優先。'
    ];
    var adviceMap = {
      0:'該当なし：セルフケアで様子観察。痛み出現で即中止、悪化や長期化は受診。',
      1:'経過観察（セルフケア）：RICE/ホット&コールド、自重〜低荷重で可動性確保。痛みゼロを条件に段階復帰。',
      2:'受診検討（黄）：症状が続く/強まる、分離/ヘルニア疑い、レッドフラッグの一部あり→整形外科受診検討。',
      3:'受診推奨（赤）：膀胱直腸障害、鞍部感覚低下、両下肢神経症状 等。緊急受診が必要。'
    };
    var classes = ['ok-badge','info-badge','warn-badge','danger-badge'];
    var labels  = ['様子観察（所見なし）','経過観察（セルフケア）','受診検討','受診推奨'];

    $('#statusBadge').className = 'badge '+classes[level];
    $('#statusBadge').textContent = labels[level];
    $('#statusText').textContent = adviceMap[level];
    $('#playText').textContent = playAdvice[level];

    var checkedLabels = $$('input[type="checkbox"]:checked').map(function(cb){
      var label = cb.closest('label'); return label?label.innerText.trim():'';
    }).filter(Boolean);
    var now = new Date();
    var ds = now.toLocaleDateString('ja-JP');
    var ts = now.toLocaleTimeString('ja-JP',{hour:'2-digit', minute:'2-digit'});
    var summary =
'【腰部セルフチェック LITE】\n'
+'日時：'+ds+' '+ts+'\n'
+'判定：'+labels[level]+'\n'
+'指針：'+adviceMap[level]+'\n'
+'参加目安：'+playAdvice[level]+'\n'
+'チェック項目：\n'
+'- '+(checkedLabels.join('\n- ') || '（なし）');
    $('#summary').textContent = summary;
  }

  function resetAll(){
    $$('input[type="checkbox"]').forEach(function(c){ c.checked=false; });
    evaluate();
  }

  hook();
  evaluate();

  var btnP=$('#btnPrint'), btnR=$('#btnReset'), btnC=$('#btnCopy');
  if(btnP) btnP.addEventListener('click', function(){ window.print(); });
  if(btnR) btnR.addEventListener('click', resetAll);
  if(btnC) btnC.addEventListener('click', function(){
    var text = ($('#summary') && $('#summary').textContent) || '';
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(function(){ alert('結果をコピーしました。'); }, function(){ fallbackCopy(text); });
    }else{ fallbackCopy(text); }
    function fallbackCopy(t){
      var ta=document.createElement('textarea'); ta.value=t; document.body.appendChild(ta);
      ta.select(); try{ document.execCommand('copy'); alert('結果をコピーしました。'); } finally{ document.body.removeChild(ta); }
    }
  });
})();
</script>
</body>
</html>
